var stylefill={allRules:new Object,allFills:new Object,init:function(e){this.allFills=e;this.getStyleSheet(e)},objSize:function(e){var t=0,n;for(n in e){if(e.hasOwnProperty(n))t++}return t},arraySliceShim:function(){"use strict";var e=Array.prototype.slice;try{e.call(document.documentElement)}catch(t){Array.prototype.slice=function(t,n){var r,i=this.length,s=[];if(this.charAt){for(r=0;r<i;r++){s.push(this.charAt(r))}}else{for(r=0;r<this.length;r++){s.push(this[r])}}return e.call(s,t,n||s.length)}}},loadFile:function(e,t,n){var r;if(window.XMLHttpRequest)r=new XMLHttpRequest;else r=new ActiveXObject("Microsoft.XMLHTTP");r.open("GET",t,true);r.onreadystatechange=function(){if(this.readyState==4&&this.status==200)stylefill.findRules(e,this.responseText,n)};r.send(null)},getStyleSheet:function(e){var t=new Array,n=Array.prototype.slice.call(document.getElementsByTagName("link"));n.push(Array.prototype.slice.call(document.getElementsByTagName("style"))[0]);n.reverse();var r=this.objSize(n);while(r-->0){var i=n[r];if(i.innerHTML)this.findRules(e,i.innerHTML,r);else if(i.href.match(document.domain))this.loadFile(e,i.href,r)}},checkRule:function(e){var t=e.replace(/(^|-)([a-z])/g,function(e,t,n){return n.toUpperCase()});if(document.body)if("Webkit"+t in document.body.style||"Moz"+t in document.body.style||"O"+t in document.body.style||e in document.body.style)return true;else return false;else return false},findRules:function(e,t,n){if(t){var r=this.objSize(e);for(property in e){var i=new RegExp("([^}{]+){([^}]+)?"+property.replace("-","\\-")+"[\\s\\t]*:[\\s\\t]*([^;]+)","gi"),s,o=stylefill.checkRule(property);while(s=i.exec(t)){var u=s[1].replace(/^([\s\n\r\t]+|\/\*.*?\*\/)+/,"").replace(/[\s\n\r\t]+$/,""),a=s[3];u=u.split(",");for(sel in u){var f=u[sel];if(!stylefill.allRules[f])stylefill.allRules[f]=new Object;stylefill.allRules[f][property]={support:o,value:a}}}}if(n==1)this.runFills()}},runFills:function(){var e=stylefill.allRules,t=stylefill.allFills;for(i in e){var n=e[i];for(j in n){var r=n[j],s=t[j],o={support:r["support"],selector:i,property:j,value:r["value"]};s(o)}}},binder:function(e,t,n){var t=t.split(","),r=t.length;while(r-->0){if(e.attachEvent)e.attachEvent("on"+t[r].trim(),n);else e.addEventListener(t[r].trim(),n,false)}}};var typo;typo={hangingPunctuation:function(e){var t,n,r={};t=document.querySelectorAll(e.selector);n=t.length;while(n-->0){var i,s,o,u,a,f,l=0,c,h;s=t[n];o=s.textContent;u=o[0];a=o[o.length-1];elStyle=window.getComputedStyle(s,null);if(e.value==="none"){}else if(e.value==="first"){if(u.match(/\“|”/)!==null){i=elStyle.fontWeight+" "+elStyle.fontSize+" "+elStyle.fontFamily+" "+elStyle.fontStretch+" "+elStyle.fontStyle;if(!(i in r)){f=document.createElement("span");f.innerHTML=u;s.appendChild(f);r[i]=f.offsetWidth;s.removeChild(f)}h=r[i];f=null;f=document.createElement("span");f.innerHTML=" ";f.style.display="inline";s.insertBefore(f,s.firstChild);var l=f.getBoundingClientRect().left;s.removeChild(f);f=null;if(s.previousElementSibling&&s.previousElementSibling.hasAttribute("data-hangPunctHelper")){s.parentElement.removeChild(s.previousElementSibling)}if(l-h-1<=s.parentElement.getBoundingClientRect().left){c=s.getBoundingClientRect().top;s.style.marginLeft=-h+"px";if(c!==s.getBoundingClientRect().top){var p=document.createElement("br");p.setAttribute("data-hangPunctHelper");s.insertBefore(p,s.firstChild)}}else{s.style.marginLeft=0}}else{}}else if(e.value==="force-end"||e.value==="allow-end"||e.value==="last"){console.warn("Not implemented yet.")}}}};stylefill.init({"hanging-punctuation":typo.hangingPunctuation})
